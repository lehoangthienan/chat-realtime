(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{162:function(e,t,n){e.exports=n(372)},167:function(e,t,n){},28:function(e,t){e.exports={api_url:"/api"}},350:function(e,t){},353:function(e,t,n){},370:function(e,t,n){},372:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(18),o=n.n(s),i=(n(167),n(22)),c=n(23),u=n(25),l=n(24),p=n(26),m=n(29),h=n(35),g=n(141),d=n(142),f=n(15),b="START_LOGIN",v="LOGIN_SUCCESSFULL",E="LOGIN_FAIL",S="LOGIN_HANDLE_ERROR",y={startLogin:!1,loginSuccessfull:!1,error:null},O="START_SIGNUP",j="SIGNUP_SUCCESSFULL",w="SIGNUP_FAIL",I="SIGNUP_HANDLE_ERROR",D={startSignup:!1,signupSuccessfull:!1,error:null},C="REQUEST_LIST_USER",k="LIST_USER_FETCH_SUCCESSFULL",L="LIST_USER_FETCH_FAIL",_="LIST_USER_HANDLE_ERROR",N={isLoading:!1,users:[],error:null},x="REQUEST_LIST_CHAT",T="LIST_CHAT_FETCH_SUCCESSFULL",R="LIST_CHAT_FETCH_FAIL",U="LIST_CHAT_HANDLE_ERROR",F={isLoading:!1,chats:[],error:null},A=Object(h.c)({loginData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:return Object(f.a)({},e,{startLogin:!0});case v:return Object(f.a)({},e,{startLogin:!1,loginSuccessfull:!0});case E:return Object(f.a)({},e,{startLogin:!1,error:t.err});case S:return Object(f.a)({},e,{error:null});default:return e}},signupData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:return Object(f.a)({},e,{startSignup:!0});case j:return Object(f.a)({},e,{startSignup:!1,signupSuccessfull:!0});case w:return Object(f.a)({},e,{startSignup:!1,error:t.err});case I:return Object(f.a)({},e,{error:null});default:return e}},userData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:return Object(f.a)({},e,{isLoading:!0});case k:return Object(f.a)({},e,{isLoading:!1,users:t.users});case L:return Object(f.a)({},e,{isLoading:!1,error:t.error});case _:return Object(f.a)({},e,{error:null});default:return e}},chatData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case x:return Object(f.a)({},e,{isLoading:!0});case T:return Object(f.a)({},e,{isLoading:!1,chats:t.chats});case R:return Object(f.a)({},e,{isLoading:!1,error:t.error});case U:return Object(f.a)({},e,{error:null});default:return e}}}),H=Object(g.createLogger)({timestamps:!0,duration:!0}),M=Object(h.e)(A,Object(h.d)(Object(h.a)(H,d.a))),W=n(374),P=n(375),B=n(161),G=n(373),Y=n(14),J=n.n(Y),q=n(27),z=n(28),Q=n.n(z);function X(e){var t=new Headers({"Content-Type":"application/json; charset=utf-8",Accept:"application/json"});return(e=e||K())&&t.append("x-access-token",e),t}n(143);var $="token";function K(){return sessionStorage.getItem($)}function V(e){sessionStorage.setItem($,e)}function Z(){return!!K()}var ee=function(e){var t=e.component,n=Object(B.a)(e,["component"]);return r.a.createElement(P.a,Object.assign({},n,{render:function(e){return Z()?r.a.createElement(t,e):r.a.createElement(G.a,{to:{pathname:"/",state:{from:e.location}}})}}))},te=n(30);function ne(e,t){return function(n){n({type:b}),function(e,t){return new Promise(function(){var n=Object(q.a)(J.a.mark(function n(a,r){return J.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fetch(Q.a.api_url+"/users/login",{method:"POST",body:JSON.stringify({username:e,password:t})}).then(function(e){return e.json()}).then(function(e){if(0===e.status)return r(e.error.message);var t=e.result.token;localStorage.setItem("userID",e.result.id),localStorage.setItem("userToken",e.result.token),V(t),a(t)}).catch(function(e){return r(e)}));case 1:case"end":return n.stop()}},n,this)}));return function(e,t){return n.apply(this,arguments)}}())}(e,t).then(function(e){n({type:v})}).catch(function(e){return n(function(e){return{type:E,err:e}}(e))})}}function ae(e,t,n,a){return function(r){r({type:O}),function(e,t,n,a){return new Promise(function(){var r=Object(q.a)(J.a.mark(function r(s,o){return J.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",fetch(Q.a.api_url+"/users",{method:"POST",body:JSON.stringify({user:{username:e,password:t,full_name:n,phone:a}})}).then(function(e){return e.json()}).then(function(e){if(0===e.status)return o(e.error.message);s(e.result)}).catch(function(e){return o(e)}));case 1:case"end":return r.stop()}},r,this)}));return function(e,t){return r.apply(this,arguments)}}())}(e,t,n,a).then(function(e){r({type:j})}).catch(function(e){return r(function(e){return{type:w,err:e}}(e))})}}var re=n(38),se=n.n(re),oe=n(19),ie=n.n(oe),ce=n(36),ue=n.n(ce),le=n(34),pe=n.n(le),me=n(144),he=n.n(me),ge=n(148),de=n.n(ge),fe=n(146),be=n.n(fe),ve=n(147),Ee=n.n(ve),Se=n(145),ye=n.n(Se),Oe=n(90),je=n.n(Oe);function we(e){return r.a.createElement(je.a,Object.assign({direction:"up"},e))}var Ie=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).state={open:!0},n.handleClose=function(){n.setState({open:!1}),n.props.onClose&&n.props.onClose()},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(he.a,{open:this.state.open,TransitionComponent:we,onClose:this.handleClose,"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description"},r.a.createElement(ye.a,{id:"alert-dialog-slide-title"},this.props.title),r.a.createElement(be.a,null,r.a.createElement(Ee.a,{id:"alert-dialog-slide-description"},this.props.children)),r.a.createElement(de.a,null,r.a.createElement(pe.a,{onClick:this.handleClose,color:"primary"},"Close")))}}]),t}(a.Component),De={container:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#E1E6E9"},paper:{width:330,padding:"20px"},btnSignIn:{width:"100%",margin:"10px 0"},hr:{backgroundColor:"#e0e0e0",height:1,border:0},textRight:{textAlign:"right"}},Ce=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={tab:1,username:"",phone:"",password:"",password1:"",password2:"",full_name:""},n.onClickLogin=n.onClickLogin.bind(Object(te.a)(Object(te.a)(n))),n.onClickSignup=n.onClickSignup.bind(Object(te.a)(Object(te.a)(n))),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onClickLogin",value:function(){var e=this.state,t=e.username,n=e.password;return t?n?void this.props.login(t,n):alert("please fill your password"):alert("please fill your username")}},{key:"onClickSignup",value:function(){var e=this.state,t=e.username,n=e.password1,a=e.password2,r=e.full_name,s=e.phone;return t?n!==a?alert("password not match"):n?s?void this.props.signup(t,n,r,s):alert("please fill your phone"):alert("please fill your password"):alert("please fill your username")}},{key:"render",value:function(){var e=this;return this.props.signupData.signupSuccessfull&&2===this.state.tab&&this.setState({tab:1}),this.props.loginData.loginSuccessfull&&this.props.history.push("/app"),r.a.createElement("div",{style:De.container},1===this.state.tab&&r.a.createElement(se.a,{elevation:1,style:De.paper},r.a.createElement(ie.a,{variant:"h5",component:"h3",align:"center"},"Sign in"),r.a.createElement(ue.a,{id:"username",label:"Your username",value:this.state.username,onChange:function(t){return e.setState({username:t.target.value})},margin:"normal",fullWidth:!0}),r.a.createElement(ue.a,{id:"password",label:"Your password",type:"password",value:this.state.password,onChange:function(t){return e.setState({password:t.target.value})},margin:"normal",fullWidth:!0}),r.a.createElement(ie.a,{variant:"body1",component:"p",align:"right",color:"primary"},"Forgot Password?"),r.a.createElement(pe.a,{variant:"contained",color:"primary",style:De.btnSignIn,disabled:this.props.loginData.startLogin&&!this.props.loginData.loginSuccessfull,onClick:this.onClickLogin},"Sign in"),r.a.createElement("hr",{style:De.hr}),r.a.createElement("div",{style:De.textRight},r.a.createElement(ie.a,{variant:"body1",component:"span",align:"right",style:{display:"inline-block"}},"Not a user?"),r.a.createElement(ie.a,{variant:"body1",component:"span",align:"right",color:"primary",style:{display:"inline-block",cursor:"pointer"},onClick:function(){return e.setState({tab:2})}},"Sign Up"))),2===this.state.tab&&r.a.createElement(se.a,{elevation:1,style:De.paper},r.a.createElement(ie.a,{variant:"h5",component:"h3",align:"center"},"Sign up"),r.a.createElement(ue.a,{id:"full_name",label:"Your full name",value:this.state.full_name,onChange:function(t){return e.setState({full_name:t.target.value})},margin:"normal",fullWidth:!0}),r.a.createElement(ue.a,{id:"phone",label:"Your phone",value:this.state.phone,onChange:function(t){return e.setState({phone:t.target.value})},margin:"normal",fullWidth:!0}),r.a.createElement(ue.a,{id:"username",label:"Your username",value:this.state.username,onChange:function(t){return e.setState({username:t.target.value})},margin:"normal",fullWidth:!0}),r.a.createElement(ue.a,{id:"password1",label:"Your password",type:"password",value:this.state.password1,onChange:function(t){return e.setState({password1:t.target.value})},margin:"normal",fullWidth:!0}),r.a.createElement(ue.a,{id:"password2",label:"Retype your password",type:"password",value:this.state.password2,onChange:function(t){return e.setState({password2:t.target.value})},margin:"normal",fullWidth:!0}),r.a.createElement(pe.a,{variant:"contained",color:"primary",style:De.btnSignIn,disabled:this.props.signupData.startSignup&&!this.props.signupData.signupSuccessfull,onClick:this.onClickSignup},"Sign up"),r.a.createElement("hr",{style:De.hr}),r.a.createElement("div",{style:De.textRight},r.a.createElement(ie.a,{variant:"body1",component:"span",align:"right",style:{display:"inline-block"}},"Have an account?"),r.a.createElement(ie.a,{variant:"body1",component:"span",align:"right",color:"primary",style:{display:"inline-block",cursor:"pointer"},onClick:function(){return e.setState({tab:1})}},"Sign In"))),!!this.props.loginData.error&&r.a.createElement(Ie,{title:"Error",onClose:this.props.handeErrorLogin},this.props.loginData.error),!!this.props.signupData.error&&r.a.createElement(Ie,{title:"Error",onClose:this.props.handeErrorSignup},this.props.signupData.error.toString()))}}]),t}(a.Component),ke=Object(m.b)(function(e){return{loginData:e.loginData,signupData:e.signupData}},function(e){return{login:function(t,n){return e(ne(t,n))},signup:function(t,n,a){return e(ae(t,n,a))},handeErrorLogin:function(){return e({type:S})},handeErrorSignup:function(){return e({type:I})}}})(Ce),Le=n(376),_e=n(39),Ne=n(156),xe=n.n(Ne),Te=n(152),Re=n.n(Te),Ue=n(91),Fe=n.n(Ue),Ae=n(157),He=n.n(Ae),Me=n(153),We=n.n(Me),Pe=n(154),Be=n.n(Pe),Ge=n(160),Ye=n.n(Ge),Je=n(158),qe=n.n(Je),ze=n(159),Qe=n.n(ze),Xe=n(155),$e=n.n(Xe),Ke=n(149),Ve=n.n(Ke),Ze=n(151),et=n.n(Ze),tt=n(31),nt=n.n(tt),at=n(150),rt=n.n(at),st=n(92),ot=n.n(st);function it(){return function(e){e({type:C}),new Promise(function(){var e=Object(q.a)(J.a.mark(function e(t,n){return J.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(Q.a.api_url+"/users",{headers:X()}).then(function(e){return e.json()}).then(function(e){if(0===e.status)return n(e.error.message);t(e.result)}).catch(function(e){return n(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()).then(function(t){e(function(e){return{type:k,users:e}}(t))}).catch(function(t){return e({type:L,error:t})})}}var ct=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).props.getListUsers(),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.userData;return r.a.createElement("div",{className:t.root},r.a.createElement(Ve.a,{className:t.table},r.a.createElement(rt.a,null,r.a.createElement(ot.a,null,r.a.createElement(nt.a,null,"#"),r.a.createElement(nt.a,null,"Full name"),r.a.createElement(nt.a,null,"Username"),r.a.createElement(nt.a,null,"Date created"))),r.a.createElement(et.a,null,n.users.map(function(e,t){return r.a.createElement(ot.a,null,r.a.createElement(nt.a,{component:"th",scope:"row"},t),r.a.createElement(nt.a,null,e.full_name),r.a.createElement(nt.a,null,e.username),r.a.createElement(nt.a,null,new Date(e.date_created).toDateString()))}))))}}]),t}(a.Component),ut=Object(m.b)(function(e){return{userData:e.userData}},function(e){return{getListUsers:function(){return e(it())}}})(Object(_e.withStyles)(function(e){return{root:{width:"100%",marginTop:3*e.spacing.unit,overflowX:"auto"},table:{minWidth:700}}})(ct)),lt=n(93),pt=n.n(lt);function mt(){return new Promise(function(){var e=Object(q.a)(J.a.mark(function e(t,n){return J.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(Q.a.api_url+"/chats",{headers:X()}).then(function(e){return e.json()}).then(function(e){if(0===e.status)return n(e.error.message);localStorage.setItem("chatData",e.result),t(e.result)}).catch(function(e){return n(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}())}function ht(){return function(e){e({type:x}),mt().then(function(t){e(function(e){return{type:T,chats:e}}(t))}).catch(function(t){return e({type:R,error:t})})}}n(353);var gt=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).onFocus=function(){var e=localStorage.getItem("userToken");n.socket=pt()("/chat",{query:{token:e}}),mt().then(function(e){var t;n.setState({chatsData:e}),n.state.chatsData.map(function(e){e.sender==n.props.match.params.userID&&e.receiver==localStorage.getItem("userID")&&(t=e._id)}),t&&n.socket.emit("isSeen",{chat_id:t}),console.log("asdasd",t)})},n.props.getListChats(),n.socket=null,n.state={status:!1,text:"",chatsData:[],seen:""},mt().then(function(e){if(n.setState({chatsData:e}),e){var t=[];e.map(function(e){e.sender==localStorage.getItem("userID")&&e.receiver==n.props.match.params.userID&&t.push(e),e.receiver==localStorage.getItem("userID")&&e.sender==n.props.match.params.userID&&t.push(e)}),t[0]&&(t[t.length-1].isSeen&&t[t.length-1].sender==localStorage.getItem("userID")?n.setState({seen:"SEEN"}):n.setState({seen:""}))}}),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onChange",value:function(e){this.setState({text:e.target.value})}},{key:"onSubmit",value:function(e){if(this.state.text){this.socket.emit("newMessage",{content:this.state.text,receiver:this.props.match.params.userID});var t={sender:localStorage.getItem("userID"),receiver:this.props.match.params.userID,content:this.state.text,_created:Date.now()};this.state.chatsData.push(t),this.setState({text:"",seen:""}),e.preventDefault()}}},{key:"componentWillMount",value:function(){var e=this,t=localStorage.getItem("userToken");this.socket=pt()("/chat",{query:{token:t}}),this.socket.on("newMessage",function(t){e.setState({chatsData:t})}),this.socket.on("isSeen",function(t){console.log("sda",t);var n=[];t.map(function(t){t.sender==localStorage.getItem("userID")&&t.receiver==e.props.match.params.userID&&n.push(t),t.receiver==localStorage.getItem("userID")&&t.sender==e.props.match.params.userID&&n.push(t)}),n[0]&&(n[n.length-1].isSeen&&n[n.length-1].sender==localStorage.getItem("userID")?e.setState({seen:"SEEN"}):e.setState({seen:""}))})}},{key:"render",value:function(){var e=this,t=this.props,n=t.classes;t.chatData;return r.a.createElement("div",{className:n.root},r.a.createElement("ul",{className:"Messages-list"},this.state.chatsData.map(function(t){return t.receiver==e.props.match.params.userID&&t.sender==localStorage.getItem("userID")?e.renderMessage(t.sender,t.content,t._created):t.receiver==localStorage.getItem("userID")&&t.sender==e.props.match.params.userID?e.renderMessage(t.sender,t.content,t._created):void 0})),r.a.createElement("div",{className:"username",style:{marginLeft:1100}},this.state.seen),r.a.createElement("div",{className:"Input"},r.a.createElement("form",{onSubmit:function(t){return e.onSubmit(t)}},r.a.createElement("input",{onFocus:this.onFocus,onChange:function(t){return e.onChange(t)},value:this.state.text,type:"text",placeholder:"Enter your message and press ENTER",autofocus:"true"}),r.a.createElement("button",null,"Send"))))}},{key:"renderMessage",value:function(e,t,n){var a=e===localStorage.getItem("userID")?"Messages-message currentMember":"Messages-message";return r.a.createElement("li",{className:a},r.a.createElement("span",{className:"avatar",style:{backgroundColor:"#189eff"}}),r.a.createElement("div",{className:"Message-content"},r.a.createElement("div",{className:"username"},n),r.a.createElement("div",{className:"text"},t)))}}]),t}(a.Component),dt=Object(m.b)(function(e){return{chatData:e.chatData}},function(e){return{getListChats:function(){return e(ht())}}})(Object(_e.withStyles)(function(e){return{root:{width:"100%",marginTop:3*e.spacing.unit,overflowX:"auto"},table:{minWidth:700}}})(gt)),ft=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).onClickSignout=n.onClickSignout.bind(Object(te.a)(Object(te.a)(n))),n.props.getListUsers(),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"onClickSignout",value:function(){sessionStorage.removeItem($),window.location.reload()}},{key:"render",value:function(){var e=this,t=this.props,n=t.classes,a=t.userData;t.chatData;return r.a.createElement("div",{className:n.root},r.a.createElement(Re.a,{position:"fixed",className:n.appBar},r.a.createElement(We.a,null,r.a.createElement(Be.a,{color:"inherit","aria-label":"Menu",className:n.appBarMenuButton},r.a.createElement($e.a,null)),r.a.createElement(ie.a,{variant:"h6",color:"inherit",className:n.appBarTitle},"Chat Realtime"),r.a.createElement(pe.a,{color:"inherit",onClick:this.onClickSignout},"Sign out"))),r.a.createElement(xe.a,{className:n.drawer,variant:"permanent"},r.a.createElement("div",{className:n.toolbar}),r.a.createElement(Fe.a,{component:"nav",subheader:r.a.createElement(He.a,{component:"div"},"Chat With Friends")},a.users.map(function(t,n){if(t._id!=localStorage.getItem("userID"))return r.a.createElement(qe.a,{button:!0,onClick:function(){return e.props.history.push({pathname:"/app/chat/"+t._id})}},r.a.createElement(Qe.a,{primary:t.full_name}))})),r.a.createElement(Ye.a,null)),r.a.createElement("main",{className:n.content},r.a.createElement("div",{className:n.toolbar}),r.a.createElement(Le.a,null,r.a.createElement(P.a,{exact:!0,path:"/app",component:ut}),r.a.createElement(P.a,{exact:!0,path:"/app/chat/:userID",render:function(e){return r.a.createElement(dt,Object.assign({},e,{key:e.match.params.userID||"empty"}))}}))))}}]),t}(a.Component),bt=Object(m.b)(function(e){return{userData:e.userData,chatData:e.chatData}},function(e){return{getListUsers:function(){return e(it())}}})(Object(_e.withStyles)(function(e){return{root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},appBarTitle:{flexGrow:1},appBarMenuButton:{marginLeft:-12,marginRight:20},drawer:{width:240,flexShrink:0},toolbar:e.mixins.toolbar,content:{flexGrow:1,padding:3*e.spacing.unit}}})(ft)),vt=function(){return r.a.createElement(W.a,null,r.a.createElement("div",null,r.a.createElement(P.a,{exact:!0,path:"/",component:ke}),r.a.createElement(ee,{path:"/app",component:bt})))},Et=(n(370),function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(m.a,{store:M},r.a.createElement(vt,null))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(Et,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[162,2,1]]]);
//# sourceMappingURL=main.dd7c0ee2.chunk.js.map